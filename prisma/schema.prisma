generator client {
  provider        = "prisma-client-js"
  previewFeatures = []
  enableTracing   = "false"
  logLevel        = "error"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id         String         @id @default(cuid())
  name       String?
  email      String         @unique
  password   String
  role       Role           @default(USER)
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  properties Property[]     @relation("ResponsibleFor")
  activities UserActivity[]
  goals      UserGoal[]
  zones      Zone[]         @relation("ZoneUsers")
}

model Property {
  id              String         @id @default(cuid())
  address         String
  population      String
  status          PropertyStatus @default(SIN_EMPEZAR)
  action          PropertyAction @default(IR_A_DIRECCION)
  ownerName       String
  ownerPhone      String
  captureDate     DateTime       @default(now())
  responsibleId   String?
  hasSimpleNote   Boolean        @default(false)
  isOccupied      Boolean        @default(false)
  clientId        String?
  zoneId          String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  latitude        Float?
  longitude       Float?
  occupiedBy      String?
  type            PropertyType   @default(CASA)
  isLocated       Boolean        @default(false)
  responsible     String?
  ascensor        Boolean        @default(false)
  banos           Int?
  habitaciones    Int?
  metrosCuadrados Int?
  parking         Boolean        @default(false)
  piscina         Boolean        @default(false)
  basePropertyId  String?        @unique
  isSold          Boolean        @default(false)
  activities      Activity[]
  assignments     Assignment[]
  dpv             DPV?
  BaseProperty    BaseProperty?  @relation(fields: [basePropertyId], references: [id])
  responsibleUser User?          @relation("ResponsibleFor", fields: [responsibleId], references: [id])
  zone            Zone?          @relation(fields: [zoneId], references: [id])
  propertyNews    PropertyNews[]
  clients         Client[]       @relation("ClientProperties")

  @@index([clientId], map: "Property_clientId_fkey")
  @@index([zoneId], map: "Property_zoneId_fkey")
  @@index([responsibleId], map: "Property_responsibleId_fkey")
  @@index([basePropertyId], map: "Property_basePropertyId_fkey")
}

model Client {
  id            String         @id @default(cuid())
  name          String
  email         String
  phone         String?
  address       String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  hasRequest    Boolean        @default(false)
  assignments   Assignment[]
  ClientRequest ClientRequest?
  properties    Property[]     @relation("ClientProperties")
}

model News {
  id        String   @id @default(cuid())
  title     String
  content   String
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Assignment {
  id             String   @id @default(cuid())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  propertyId     String
  clientId       String
  buyerFeeType   String
  buyerFeeValue  Float
  exclusiveUntil DateTime
  origin         String
  price          Float
  sellerFeeType  String
  sellerFeeValue Float
  type           String
  client         Client   @relation(fields: [clientId], references: [id])
  property       Property @relation(fields: [propertyId], references: [id])

  @@index([propertyId], map: "Assignment_propertyId_fkey")
  @@index([clientId], map: "Assignment_clientId_fkey")
}

model Zone {
  id          String     @id @default(cuid())
  name        String
  description String?
  color       String     @default("#FF0000")
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  coordinates Json
  properties  Property[]
  users       User[]     @relation("ZoneUsers")
}

model Activity {
  id         String   @id @default(cuid())
  type       String
  status     String   @default("Programada")
  date       DateTime
  client     String?
  notes      String?
  propertyId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  property   Property @relation(fields: [propertyId], references: [id])

  @@index([propertyId], map: "Activity_propertyId_fkey")
}

model DPV {
  id             String   @id @default(cuid())
  links          Json
  realEstate     String?
  phone          String?
  currentPrice   Float?
  estimatedValue Float?
  propertyId     String   @unique
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  property       Property @relation(fields: [propertyId], references: [id])

  @@index([propertyId], map: "DPV_propertyId_fkey")
}

model PropertyNews {
  id              String   @id @default(cuid())
  type            String
  action          String
  valuation       String
  priority        String
  responsible     String
  value           Float
  propertyId      String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  precioCliente   Float?
  precioSM        Float?
  commissionType  String   @default("percentage")
  commissionValue Float    @default(3)
  property        Property @relation(fields: [propertyId], references: [id])

  @@index([propertyId])
}

model ClientRequest {
  id           String   @id
  clientId     String   @unique
  bedrooms     Int
  bathrooms    Int
  minPrice     Float
  maxPrice     Float
  propertyType String
  features     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  type         String   @default("SALE")
  Client       Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

model UserGoal {
  id           String         @id @default(cuid())
  userId       String
  title        String
  description  String?
  targetCount  Int
  currentCount Int            @default(0)
  startDate    DateTime       @default(now())
  endDate      DateTime?
  isCompleted  Boolean        @default(false)
  category     String         @default("GENERAL")
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  activities   UserActivity[]
  user         User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model UserActivity {
  id          String    @id @default(cuid())
  userId      String
  goalId      String?
  type        String
  description String?
  timestamp   DateTime  @default(now())
  metadata    Json?
  relatedId   String?
  relatedType String?
  points      Int       @default(1)
  goal        UserGoal? @relation(fields: [goalId], references: [id])
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([goalId])
}

model CatastroProperty {
  id              String   @id @default(cuid())
  reference       String   @unique
  streetType      String?
  streetName      String?
  number          String?
  block           String?
  stairway        String?
  floor           String?
  door            String?
  reformType      String?
  age             String?
  quality         String?
  constructedArea String?
  propertyType    String?
  address         String?
  latitude        Float?
  longitude       Float?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([reference])
  @@index([streetName, number])
}

model BaseProperty {
  id              String            @id
  address         String
  population      String
  latitude        Float?
  longitude       Float?
  type            BaseProperty_type @default(CASA)
  habitaciones    Int?
  banos           Int?
  metrosCuadrados Int?
  parking         Boolean           @default(false)
  ascensor        Boolean           @default(false)
  piscina         Boolean           @default(false)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  Property        Property?
}

enum Role {
  ADMIN
  USER
}

enum PropertyType {
  CHALET
  PISO
  CASA
  APARTAMENTO
  ATICO
  DUPLEX
  TERRENO
  LOCAL_COMERCIAL
  OFICINA
  GARAJE
  TRASTERO
}

enum PropertyAction {
  IR_A_DIRECCION
  REPETIR
  LOCALIZAR_VERIFICADO
}

enum BaseProperty_type {
  CHALET
  PISO
  CASA
  APARTAMENTO
  ATICO
  DUPLEX
  TERRENO
  LOCAL_COMERCIAL
  OFICINA
  GARAJE
  TRASTERO
}

enum PropertyStatus {
  SIN_EMPEZAR
  EMPEZADA
  SOLD
}
