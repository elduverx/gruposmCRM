generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id         String     @id @default(cuid())
  name       String?
  email      String     @unique
  password   String
  role       Role       @default(USER)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  properties Property[] @relation("ResponsibleFor")
}

model Property {
  id              String         @id @default(cuid())
  address         String
  population      String
  status          PropertyStatus @default(SIN_EMPEZAR)
  action          PropertyAction @default(IR_A_DIRECCION)
  ownerName       String
  ownerPhone      String
  captureDate     DateTime       @default(now())
  responsibleId   String?
  hasSimpleNote   Boolean        @default(false)
  isOccupied      Boolean        @default(false)
  clientId        String?
  zoneId          String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  latitude        Float?
  longitude       Float?
  occupiedBy      String?
  type            PropertyType   @default(CASA)
  isLocated       Boolean        @default(false)
  responsible     String?
  activities      Activity[]
  assignments     Assignment[]
  dpv             DPV?
  propertyNews    PropertyNews[]
  responsibleUser User?          @relation("ResponsibleFor", fields: [responsibleId], references: [id])
  zone            Zone?          @relation(fields: [zoneId], references: [id])
  clients         Client[]       @relation("ClientProperties")

  @@index([clientId], map: "Property_clientId_fkey")
  @@index([zoneId], map: "Property_zoneId_fkey")
  @@index([responsibleId], map: "Property_responsibleId_fkey")
}

model Client {
  id          String       @id @default(cuid())
  name        String
  email       String       @unique
  phone       String?
  address     String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  hasRequest  Boolean      @default(false)
  assignments Assignment[]
  properties  Property[]   @relation("ClientProperties")
}

model News {
  id        String   @id @default(cuid())
  title     String
  content   String
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Assignment {
  id              String   @id @default(cuid())
  type            String   // SALE o RENT
  price           Float
  exclusiveUntil  DateTime
  origin          String
  clientId        String
  sellerFeeType   String   // PERCENTAGE o FIXED
  sellerFeeValue  Float
  buyerFeeType    String   // PERCENTAGE o FIXED
  buyerFeeValue   Float
  propertyId      String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  property        Property @relation(fields: [propertyId], references: [id])
  client          Client   @relation(fields: [clientId], references: [id])

  @@index([propertyId], map: "Assignment_propertyId_fkey")
  @@index([clientId], map: "Assignment_clientId_fkey")
}

model Zone {
  id          String     @id @default(cuid())
  name        String
  description String?
  color       String     @default("#FF0000")
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  coordinates Json
  properties  Property[]
}

model Activity {
  id         String   @id @default(cuid())
  type       String
  status     String   @default("Programada")
  date       DateTime
  client     String?
  notes      String?
  propertyId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  property   Property @relation(fields: [propertyId], references: [id])

  @@index([propertyId], map: "Activity_propertyId_fkey")
}

model DPV {
  id             String   @id @default(cuid())
  links          Json
  realEstate     String?
  phone          String?
  currentPrice   Float?
  estimatedValue Float?
  propertyId     String   @unique
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  property       Property @relation(fields: [propertyId], references: [id])

  @@index([propertyId], map: "DPV_propertyId_fkey")
}

model PropertyNews {
  id          String   @id @default(cuid())
  type        String   // DPV o PVA
  action      String   // SALE o RENT
  valuation   String   // PRECIOSM o PRECIO_CLIENTE
  priority    String   // HIGH o LOW
  responsible String
  value       Float?
  propertyId  String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  property    Property @relation(fields: [propertyId], references: [id])

  @@index([propertyId], map: "PropertyNews_propertyId_fkey")
}

enum Role {
  ADMIN
  USER
}

enum PropertyType {
  CHALET
  PISO
  CASA
  APARTAMENTO
  ATICO
  DUPLEX
  TERRENO
  LOCAL_COMERCIAL
  OFICINA
  GARAJE
  TRASTERO
}

enum PropertyStatus {
  SIN_EMPEZAR
  EMPEZADA
}

enum PropertyAction {
  IR_A_DIRECCION
  REPETIR
  LOCALIZAR_VERIFICADO
}

enum AssignmentStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}
