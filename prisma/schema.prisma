generator client {
  provider = "prisma-client-js"
  previewFeatures = []
  enableTracing = false
  logLevel = "error"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id         String     @id @default(cuid())
  name       String?
  email      String     @unique
  password   String
  role       Role       @default(USER)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  properties Property[] @relation("ResponsibleFor")
}

model Property {
  id              String         @id @default(cuid())
  address         String
  population      String
  status          OperationType  @default(SALE)
  action          PropertyAction @default(IR_A_DIRECCION)
  ownerName       String
  ownerPhone      String
  captureDate     DateTime       @default(now())
  responsibleId   String?
  hasSimpleNote   Boolean        @default(false)
  isOccupied      Boolean        @default(false)
  clientId        String?
  zoneId          String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  latitude        Float?
  longitude       Float?
  occupiedBy      String?
  type            PropertyType   @default(CASA)
  isLocated       Boolean        @default(false)
  responsible     String?
  habitaciones    Int?
  banos           Int?
  metrosCuadrados Int?
  parking         Boolean        @default(false)
  ascensor        Boolean        @default(false)
  piscina         Boolean        @default(false)
  activities      Activity[]
  assignments     Assignment[]
  dpv             DPV?
  responsibleUser User?          @relation("ResponsibleFor", fields: [responsibleId], references: [id])
  zone            Zone?          @relation(fields: [zoneId], references: [id])
  propertyNews    PropertyNews[]
  clients         Client[]       @relation("ClientProperties")

  @@index([clientId], map: "Property_clientId_fkey")
  @@index([zoneId], map: "Property_zoneId_fkey")
  @@index([responsibleId], map: "Property_responsibleId_fkey")
}

model Client {
  id            String         @id @default(cuid())
  name          String
  email         String
  phone         String?
  address       String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  hasRequest    Boolean        @default(false)
  assignments   Assignment[]
  ClientRequest ClientRequest?
  properties    Property[]     @relation("ClientProperties")
}

model News {
  id        String   @id @default(cuid())
  title     String
  content   String
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Assignment {
  id             String   @id @default(cuid())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  propertyId     String
  clientId       String
  buyerFeeType   String
  buyerFeeValue  Float
  exclusiveUntil DateTime
  origin         String
  price          Float
  sellerFeeType  String
  sellerFeeValue Float
  type           String
  client         Client   @relation(fields: [clientId], references: [id])
  property       Property @relation(fields: [propertyId], references: [id])

  @@index([propertyId], map: "Assignment_propertyId_fkey")
  @@index([clientId], map: "Assignment_clientId_fkey")
}

model Zone {
  id          String     @id @default(cuid())
  name        String
  description String?
  color       String     @default("#FF0000")
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  coordinates Json
  properties  Property[]
}

model Activity {
  id         String   @id @default(cuid())
  type       String
  status     String   @default("Programada")
  date       DateTime
  client     String?
  notes      String?
  propertyId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  property   Property @relation(fields: [propertyId], references: [id])

  @@index([propertyId], map: "Activity_propertyId_fkey")
}

model DPV {
  id             String   @id @default(cuid())
  links          Json
  realEstate     String?
  phone          String?
  currentPrice   Float?
  estimatedValue Float?
  propertyId     String   @unique
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  property       Property @relation(fields: [propertyId], references: [id])

  @@index([propertyId], map: "DPV_propertyId_fkey")
}

model PropertyNews {
  id              String   @id @default(cuid())
  type            String
  action          String
  valuation       String
  priority        String
  responsible     String
  value           Float
  propertyId      String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  precioCliente   Float?
  precioSM        Float?
  commissionType  String   @default("percentage")
  commissionValue Float    @default(3)
  property        Property @relation(fields: [propertyId], references: [id])

  @@index([propertyId])
}

model ClientRequest {
  id           String    @id
  clientId     String    @unique
  type         String    @default("SALE")
  bedrooms     Int
  bathrooms    Int
  minPrice     Float
  maxPrice     Float
  propertyType String
  features     String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  Client       Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

enum Role {
  ADMIN
  USER
}

enum PropertyType {
  CHALET
  PISO
  CASA
  APARTAMENTO
  ATICO
  DUPLEX
  TERRENO
  LOCAL_COMERCIAL
  OFICINA
  GARAJE
  TRASTERO
}

enum PropertyStatus {
  SIN_EMPEZAR
  EMPEZADA
}

enum PropertyAction {
  IR_A_DIRECCION
  REPETIR
  LOCALIZAR_VERIFICADO
}

enum OperationType {
  SALE
  RENT
}
